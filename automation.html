<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>파일 다운로드 및 수정 자동화</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />

    <!-- custom.css -->
    <link rel="stylesheet" type="text/css" href="/assets/built/custom.css" />

    <!-- 웹 폰트 설정 -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/nanumgothic.css">

    <!-- awesome icon -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- syntax.css -->
    <link rel="stylesheet" href="/assets/built/syntax.css">

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta
  name="description"
  content="wind-flow Tech Blog"
/>
<link
  rel="shortcut icon"
  href="https://wind-flow.github.io/assets/built/images/wind-flow.png"
  type="image/png"
/>
<link
  rel="canonical"
  href="https://wind-flow.github.io/automation"
/>
<meta name="referrer" content="no-referrer-when-downgrade" />


<!--title below is coming from _includes/dynamic_title-->
<meta property="og:site_name" content="wind-flow Tech Blog" />
<meta property="og:type" content="website" />
<meta
  property="og:title"
  content="파일 다운로드 및 수정 자동화"
/>
<meta
  property="og:description"
  content="개론 「전자금융감독규정」제 16조에 따라 백신 엔진 패턴을 항상 최신화 해야합니다. 보통의 PC는 인터넷이 연결되어있기 때문에 백신 엔진 패턴이 자동으로 업데이트 되지만, 금융권은 망분리 규정으로인해 인터넷이 불가하기때문에 백신 공식 홈페이지에서 패턴 파일을 직접 다운받아 내부망으로 이동시킨 후 수동으로 업데이트를 해야합니다. 매일 하기엔 공수가 많이들어 자동으로 파일을 다운로드 받고, 업로드할 수 있는"
/>
<meta
  property="og:url"
  content="https://wind-flow.github.io/automation"
/>
<meta
  property="og:image"
  content="https://wind-flow.github.io/assets/built/images/python/python.png"
/>
<meta
  property="article:publisher"
  content="https://www.facebook.com/"
/>
<meta
  property="article:author"
  content="https://www.facebook.com/"
/>
<meta
  property="article:published_time"
  content="2022-03-07T16:06:36+09:00"
/>
<meta
  property="article:modified_time"
  content="2022-03-07T16:06:36+09:00"
/>
<meta
  property="article:tag"
  content="Python"
/>
<meta name="twitter:card" content="summary_large_image" />
<meta
  name="twitter:title"
  content="파일 다운로드 및 수정 자동화"
/>
<meta
  name="twitter:description"
  content="개론 「전자금융감독규정」제 16조에 따라 백신 엔진 패턴을 항상 최신화 해야합니다. 보통의 PC는 인터넷이 연결되어있기 때문에 백신 엔진 패턴이 자동으로 업데이트 되지만, 금융권은 망분리 규정으로인해 인터넷이 불가하기때문에 백신 공식 홈페이지에서 패턴 파일을 직접 다운받아 내부망으로 이동시킨 후 수동으로 업데이트를 해야합니다. 매일 하기엔 공수가 많이들어 자동으로 파일을 다운로드 받고, 업로드할 수 있는"
/>
<meta name="twitter:url" content="https://wind-flow.github.io/" />
<meta
  name="twitter:image"
  content="https://wind-flow.github.io/assets/built/images/python/python.png"
/>
<meta name="twitter:label1" content="Written by" />
<meta name="twitter:data1" content="wind-flow Tech Blog" />
<meta name="twitter:label2" content="Filed under" />
<meta
  name="twitter:data2"
  content="Python"
/>
<meta name="twitter:site" content="@" />
<meta name="twitter:creator" content="@" />
<meta property="og:image:width" content="1400" />
<meta property="og:image:height" content="933" />

<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
      "@type": "Organization",
      "name": "wind-flow Tech Blog",
      "logo": "https://wind-flow.github.io/"
    },
    "url": "https://wind-flow.github.io/automation",
    "image": {
      "@type": "ImageObject",
      "url": "https://wind-flow.github.io/assets/built/images/python/python.png",
      "width": 2000,
      "height": 666
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://wind-flow.github.io/automation"
    },
    "description": "개론 「전자금융감독규정」제 16조에 따라 백신 엔진 패턴을 항상 최신화 해야합니다. 보통의 PC는 인터넷이 연결되어있기 때문에 백신 엔진 패턴이 자동으로 업데이트 되지만, 금융권은 망분리 규정으로인해 인터넷이 불가하기때문에 백신 공식 홈페이지에서 패턴 파일을 직접 다운받아 내부망으로 이동시킨 후 수동으로 업데이트를 해야합니다. 매일 하기엔 공수가 많이들어 자동으로 파일을 다운로드 받고, 업로드할 수 있는"
  }
</script>
<script
  async
  src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6619794523475927"
  crossorigin="anonymous"
></script>
<!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

<meta name="generator" content="Jekyll 3.6.2" />
<link
  rel="alternate"
  type="application/rss+xml"
  title="파일 다운로드 및 수정 자동화"
  href="/feed.xml"
/>


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://wind-flow.github.io/">wind-flow Tech Blog</a>
            
        
        
            <ul class="nav" role="menu">
  <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
  <li class="nav-about" role="menuitem">
    <a href="/about/">About</a>
  </li>
  <li class="nav-splunk" role="menuitem">
    <a href="/tag/splunk/">splunk</a>
  </li>
  <!-- <li class="nav-python" role="menuitem"><a href="/tag/python/">Python</a></li> -->
  <li class="nav-archive" role="menuitem">
    <a href="/archive.html">All Posts</a>
  </li>
  <li class="nav-archive" role="menuitem">
    <a href="/author_archive.html">Tag별 Posts</a>
  </li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">search</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-python tag-automation tag-script post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime=" 7 March 2022"> 7 March 2022</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/python/'>PYTHON</a>,
                            
                        
                            
                               <a href='/tag/automation/'>AUTOMATION</a>,
                            
                        
                            
                               <a href='/tag/script/'>SCRIPT</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">파일 다운로드 및 수정 자동화</h1>
            </header>

            <!-- 
            <figure class="post-full-image" style="background-image: url(/assets/built/images/python/python.png)">
            </figure>
             -->

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <h1 id="개론">개론</h1>

<p>「전자금융감독규정」제 16조에 따라 백신 엔진 패턴을 항상 최신화 해야합니다.
<img src="https://wind-flow.github.io/assets/built/images/automation/2022-03-07-16-19-56.png" alt="" /></p>

<p>보통의 PC는 인터넷이 연결되어있기 때문에 백신 엔진 패턴이 자동으로 업데이트 되지만, 금융권은 망분리 규정으로인해 인터넷이 불가하기때문에 백신 공식 홈페이지에서 패턴 파일을 직접 다운받아 내부망으로 이동시킨 후 수동으로 업데이트를 해야합니다.</p>

<p>매일 하기엔 공수가 많이들어 자동으로 파일을 다운로드 받고, 업로드할 수 있는 자동화 스크립트를 작성해보겠습니다.</p>

<h1 id="업무설명">업무설명</h1>

<ol>
  <li>안랩 공식홈페이지에 로그인한다.</li>
  <li>패턴 파일을 다운로드 한다.(zip, ahc, exe파일)</li>
  <li>다운로드 받은 파일이 이상없는지 무결성 검사를 한다.(hash값 비교)
<img src="https://wind-flow.github.io/assets/built/images/automation/AVPatternDownload.gif" alt="" /></li>
  <li>USB로 옮긴다.
<img src="https://wind-flow.github.io/assets/built/images/automation/2022-04-01-10-55-39.png" alt="" /></li>
</ol>

<h1 id="구현-전략">구현 전략</h1>

<p>크롬을 자동으로 띄우고, 로그인 후 다운로드를 받는 기능을 구현해야합니다.
위의 기능을 구현하기 위해서는 크롬을 동적으로 다룰 수 있는 <strong>셀레니움</strong>과 <strong>Chrome driver</strong>를 사용합니다.</p>

<h2 id="셀레니움-">셀레니움 ?</h2>

<p>셀레니움은 웹 애플리케이션 테스트를 위한 프레임워크입니다. 웹 UI, 기능 테스트 뿐 아니라 크롤링에도 많이 사용됩니다.</p>

<h2 id="크롬-드라이버-">크롬 드라이버 ?</h2>

<p>크롬 드라이버는 크롬브라우저를 컨트롤 할 수 있게 해주는 파일입니다. 셀레니움으로 크롬 드라이버 기능을 사용하여 크롬 브라우저를 조작할 예정입니다.</p>

<h1 id="구현">구현</h1>

<p>우선 크롬 드라이버를 다운받습니다. 설치된 크롬 버전에 맞는 드라이버를 다운받아야합니다.</p>

<h3 id="크롬-버전-확인하기">크롬 버전 확인하기</h3>

<p>※ 해당 코드는 아래 포스트를 참고하여 작성하였습니다.
<a href="https://dc7303.github.io/python/essay/2019/12/01/pythonMakedCrawler1">크롤링으로 업무 자동화</a></p>

<ol>
  <li>우측상단 더보기 아이콘 클릭 후 설정
<img src="https://wind-flow.github.io/assets/built/images/automation/2022-03-07-17-36-00.png" alt="" /></li>
  <li>크롬 버전정보
<img src="https://wind-flow.github.io/assets/built/images/automation/2022-03-07-17-28-56.png" alt="" /></li>
</ol>

<p>버전은 98.0.4758.102이므로, 해당버전을 다운받습니다.
<img src="https://wind-flow.github.io/assets/built/images/automation/2022-03-07-17-32-39.png" alt="" />
<a href="https://chromedriver.chromium.org/downloads">크롬 다운로드 홈페이지</a></p>

<h3 id="셀레니움-사용하기">셀레니움 사용하기</h3>

<pre><code class="language-cmd">pip install selenum
</code></pre>

<p><strong>chromedirver.py</strong> 파일을 생성하고, 셀레니움 webdriver를 import 합니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
</code></pre></div></div>

<h3 id="크롬-조작-인스턴스-정의">크롬 조작 인스턴스 정의</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="k">def</span> <span class="nf">generate_chrome</span><span class="p">(</span>
    <span class="n">driver_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">download_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">headless</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="bp">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">webdriver</span><span class="p">:</span>
    <span class="s">"""
    크롭 웹드라이버 인스턴스 생성

    :param driver_path: 드라이버 경로
    :param download_path: 파일 다운로드 경로
    :param headless: headless 옵션 설정 플래그

    :return webdriver: 크롬 드라이버 인스턴스
    """</span>
</code></pre></div></div>

<h3 id="크롬-브라우저-옵션-세팅">크롬 브라우저 옵션 세팅</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="k">def</span> <span class="nf">generate_chrome</span><span class="p">(</span>
    <span class="n">driver_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">download_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">headless</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="bp">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">webdriver</span><span class="p">:</span>
    <span class="s">"""
    크롭 웹드라이버 인스턴스 생성

    :param driver_path: 드라이버 경로
    :param download_path: 파일 다운로드 경로
    :param headless: headless 옵션 설정 플래그
    :return webdriver: 크롬 드라이버 인스턴스
    """</span>

    <span class="n">options</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">headless</span><span class="p">:</span>
        <span class="n">options</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'headless'</span><span class="p">)</span>
        <span class="n">options</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--disable-gpu'</span><span class="p">)</span>
    <span class="n">options</span><span class="p">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s">'prefs'</span><span class="p">,</span> <span class="p">{</span>
        <span class="s">'download.default_directory'</span><span class="p">:</span> <span class="n">download_path</span><span class="p">,</span>
        <span class="s">"profile.default_content_settings.popups"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">"safebrowsing.enabled"</span><span class="p">:</span> <span class="bp">True</span>
    <span class="p">})</span>

    <span class="n">chrome</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="n">driver_path</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">headless</span><span class="p">:</span>
        <span class="n">_enable_download_in_headless_chrome</span><span class="p">(</span><span class="n">chrome</span><span class="p">,</span> <span class="n">download_path</span><span class="p">)</span>

    <span class="n">atexit</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="n">_close_chrome</span><span class="p">(</span><span class="n">chrome</span><span class="p">))</span>       <span class="c1"># 스크립트 종료전 무조건 크롬 종료
</span>
    <span class="k">return</span> <span class="n">chrome</span>
</code></pre></div></div>

<p><strong>headless</strong> : 브라우저 창을 띄우지않고 프로세스를 실행합니다.</p>

<p><strong>–disable-gpu</strong> : 브라우저가 CPU의 부담을 줄이고자 렌더링 시 GPU를 사용하여 그래픽 가속을 하는데, GPU 버그가 일어날 수 있기때문에 GPU 사용을 disable 시킵니다.</p>

<p><strong>download.default_directory: download_path</strong> : 다운로드 경로를 download_path로 설정합니다.<br />
<strong>profile.default_content_settings.popups: 0</strong> : 팝업을 금지합니다.<br />
<strong>safebrowsing.enabled: True</strong> : 세이프 브라우징모드를 킵니다. 이 설정을 하지 않는다면, exe파일 다운로드 받을 때 경고창이 울려 자동으로 다운로드받지 못합니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">_enable_download_in_headless_chrome</span><span class="p">(</span><span class="n">driver</span><span class="p">:</span> <span class="n">webdriver</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="s">"""
        headless does not allow file download: https://bugs.chromium.org/p/chromium/issues/detail?id=696481
        크롬 드라이버는 크롤링을 이용한 해킹을 예방하기 위해 기본적으로 headless 모드에서 다운로드를 지원하지 않는다.
        전문을 먼저 보내야 사용이 가능. 자세한 내용 위 링크 참조
        :param driver: 크롬 드라이버 인스턴스
        :param download_dir: 파일 다운로드 경로
        """</span>
        <span class="n">driver</span><span class="p">.</span><span class="n">command_executor</span><span class="p">.</span><span class="n">_commands</span><span class="p">[</span><span class="s">"send_command"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s">"POST"</span><span class="p">,</span> <span class="s">'/session/$sessionId/chromium/send_command'</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'cmd'</span><span class="p">:</span> <span class="s">'Page.setDownloadBehavior'</span><span class="p">,</span>
            <span class="s">'params'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">'behavior'</span><span class="p">:</span> <span class="s">'allow'</span><span class="p">,</span>
                <span class="s">'downloadPath'</span><span class="p">:</span> <span class="n">download_dir</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">driver</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"send_command"</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="크롬-종료-함수">크롬 종료 함수</h3>

<p>모든 프로세스가 끝나면 크롬을 종료합니다. atexit를 통해 프로세스 종료 직전에 실행됩니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">_close_chrome</span><span class="p">(</span><span class="n">chrome</span><span class="p">:</span> <span class="n">webdriver</span><span class="p">):</span>
    <span class="s">"""
    크롬 종료
    :param chrome: 크롬 드라이버 인스턴스
    """</span>
    <span class="k">def</span> <span class="nf">close</span><span class="p">():</span>
        <span class="n">chrome</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">close</span>
</code></pre></div></div>

<h3 id="최종적인-chromedriver-코드">최종적인 chromedriver 코드</h3>

<noscript><pre>import atexit
from selenium import webdriver

def _enable_download_in_headless_chrome(driver: webdriver, download_dir: str):
        &quot;&quot;&quot;
        headless does not allow file download: https://bugs.chromium.org/p/chromium/issues/detail?id=696481
        크롬 드라이버는 크롤링을 이용한 해킹을 예방하기 위해 기본적으로 headless 모드에서 다운로드를 지원하지 않는다.
        전문을 먼저 보내야 사용이 가능. 자세한 내용 위 링크 참조
        :param driver: 크롬 드라이버 인스턴스
        :param download_dir: 파일 다운로드 경로
        &quot;&quot;&quot;
        driver.command_executor._commands[&quot;send_command&quot;] = (&quot;POST&quot;, &#39;/session/$sessionId/chromium/send_command&#39;)

        params = {
            &#39;cmd&#39;: &#39;Page.setDownloadBehavior&#39;,
            &#39;params&#39;: { 
                &#39;behavior&#39;: &#39;allow&#39;,
                &#39;downloadPath&#39;: download_dir
            }
        }
        driver.execute(&quot;send_command&quot;, params)


def _close_chrome(chrome: webdriver):
    &quot;&quot;&quot;
    크롬 종료
    :param chrome: 크롬 드라이버 인스턴스
    &quot;&quot;&quot;
    def close():
        chrome.close()
    return close


def generate_chrome(
    driver_path: str,
    download_path: str,
    headless: bool=False
    ) -&gt; webdriver:
    &quot;&quot;&quot;
    크롭 웹드라이버 인스턴스 생성
    
    :param driver_path: 드라이버 경로
    :param download_path: 파일 다운로드 경로
    :param headless: headless 옵션 설정 플래그
    :return webdriver: 크롬 드라이버 인스턴스
    &quot;&quot;&quot;

    options = webdriver.ChromeOptions()
    if headless:
        options.add_argument(&#39;headless&#39;)
        options.add_argument(&#39;--disable-gpu&#39;)
    options.add_experimental_option(&#39;prefs&#39;, {
        &#39;download.default_directory&#39;: download_path,
        &#39;download.prompt_for_download&#39;: False,
        &quot;profile.default_content_settings.popups&quot;: 0,
        &quot;safebrowsing.enabled&quot;: True
    })
    
    chrome = webdriver.Chrome(executable_path=driver_path, options=options)

    if headless:
        _enable_download_in_headless_chrome(chrome, download_path)

    atexit.register(_close_chrome(chrome))       # 스크립트 종료전 무조건 크롬 종료

    return chrome</pre></noscript>
<script src="https://gist.github.com/wind-flow/9cf8aa4532f23ff586ca508156b0e9f8.js"> </script>

<h3 id="인스턴스-생성">인스턴스 생성</h3>

<p>크롬 브라우저 기동 기능은 완료했습니다. 이제 자동화 기능을 구현만 남았습니다.</p>

<p>프로젝트/다운로드 경로, 운영체제 판별을 위한 모듈을 import하고, 프로젝트, 다운로드, 드라이버 경로를 설정합니다.</p>

<p>그 후 운영체제를 판별하고, 해당 운영체제에 맞는 드라이버를 사용할 수 있도록 설정해줍니다.</p>

<p>그 후 크롬 인스턴스를 생성합니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python
# main.py
</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="kn">from</span> <span class="nn">chromedriver</span> <span class="kn">import</span> <span class="n">generate_chrome</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>

<span class="c1"># 프로젝트, 다운로드 경로 설정
</span><span class="n">PROJECT_DIR</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)))</span>
<span class="n">DOWNLOAD_DIR</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">PROJECT_DIR</span><span class="si">}</span><span class="s">\download'</span>
<span class="n">driver_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">PROJECT_DIR</span><span class="si">}</span><span class="s">/lib/webDriver/'</span>

<span class="c1"># 운영체제 판별
</span><span class="n">platform</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">platform</span>
<span class="k">if</span> <span class="n">platform</span> <span class="o">==</span> <span class="s">'darwin'</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'System platform : Darwin'</span><span class="p">)</span>
    <span class="n">driver_path</span> <span class="o">+=</span> <span class="s">'chromedriverMac'</span>
<span class="k">elif</span> <span class="n">platform</span> <span class="o">==</span> <span class="s">'linux'</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'System platform : Linux'</span><span class="p">)</span>
    <span class="n">driver_path</span> <span class="o">+=</span> <span class="s">'chromedriverLinux'</span>
<span class="k">elif</span> <span class="n">platform</span> <span class="o">==</span> <span class="s">'win32'</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'System platform : Window'</span><span class="p">)</span>
    <span class="n">driver_path</span> <span class="o">+=</span> <span class="s">'chromedriverWindow'</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'[</span><span class="si">{</span><span class="n">sys</span><span class="p">.</span><span class="n">platform</span><span class="si">}</span><span class="s">] not supported. Check your system platform.'</span><span class="p">)</span>
    <span class="k">raise</span> <span class="nb">Exception</span><span class="p">()</span>

<span class="c1"># 크롬 드라이버 인스턴스 생성
</span><span class="n">chrome</span> <span class="o">=</span> <span class="n">generate_chrome</span><span class="p">(</span>
    <span class="n">driver_path</span><span class="o">=</span><span class="n">driver_path</span><span class="p">,</span>
    <span class="n">headless</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">download_path</span><span class="o">=</span><span class="n">DOWNLOAD_DIR</span><span class="p">)</span>
</code></pre></div></div>

<p>다음은 업무 수행 절차를 코드로 구현하면 됩니다.</p>

<p>구현하려면 셀레니움의 <strong>메소드 동작방식</strong>과 <strong>XPath</strong>에 대해서 알아야합니다.</p>

<p>위 작업을 자동화 하려면 특정 엘리먼트들(버튼, input 등)을 <strong>선택</strong>하고 <strong>입력</strong>하고 <strong>클릭</strong>하는 기능을 python으로 구현해야합니다.</p>

<p>셀레니움으로 엘리먼트를 선택하는 문법은 두가지 입니다.
하나는 엘리먼트의 attr(id)로 선택하는 방법과 XPath로 선택하는 방법입니다.</p>

<p>attr로 선택하는 방법은 보편적이니 따로 설정하지않고, XPath로 선택하는 방법을 소개하겠습니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">chrome</span><span class="p">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s">'XPath'</span><span class="p">)</span>
</code></pre></div></div>

<p>XPath는 XML문장 속의 요소, 속성 등을 지정하기 위한 언어입니다.
선택할 엘리먼트 태그를 우클릭하면 해당 엘리먼트의 XPath를 얻을 수 있습니다.</p>

<p><img src="https://wind-flow.github.io/assets/built/images/automation/2022-04-01-11-22-58.png" alt="XPath" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">elm</span> <span class="o">=</span> <span class="n">chrome</span><span class="p">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s">'//*[@id="root"]/div/div[2]/div[1]/div[1]/button[1]/span[1]'</span><span class="p">)</span>
<span class="n">elm</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">elm</span> <span class="o">=</span> <span class="n">chrome</span><span class="p">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'id'</span><span class="p">)</span>
<span class="n">elm</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'사용할 ID'</span><span class="p">)</span>
<span class="n">elm</span> <span class="o">=</span> <span class="n">chrome</span><span class="p">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'password'</span><span class="p">)</span>
<span class="n">elm</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'사용할 PW'</span><span class="p">)</span>

<span class="n">elm</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="n">ENTER</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>click() : 선택한 엘리먼트를 클릭합니다.</li>
  <li>send_keys(a) : 선택한 엘리먼트에 a값을 넣습니다.</li>
</ul>

<p>크롬 인스턴스의 find_element_by_XX 메소드를 이용해 선택할 엘리먼트의 id를 넣고, send_keys 메소드를 이용해 값을 넣어 <strong>업무설명</strong>에서 소개한 진행절차대로 작업을 수행해줍니다.</p>

<p>※ 작업 중간마다 sleep함수를 넣은 이유는, 작업 완료 전에 다음 작업을 수행할 수 있기 때문입니다.</p>

<p><strong>파일 다운로드 버튼</strong>을 클릭하려면 특정 엘리먼트를 클릭해야 버튼 엘리먼트가 생기는 경우가 있습니다.
<img src="https://wind-flow.github.io/assets/built/images/automation/disappearElement.gif" alt="" /></p>

<p>코드는 아래와 같습니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># login ~ enter download page
</span><span class="n">url</span> <span class="o">=</span> <span class="s">'https://mycompany.ahnlab.com/'</span>
<span class="n">chrome</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>

<span class="n">elm</span> <span class="o">=</span> <span class="n">chrome</span><span class="p">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s">'//*[@id="root"]/div/div[2]/div[1]/div[1]/button[1]/span[1]'</span><span class="p">)</span>
<span class="n">elm</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">elm</span> <span class="o">=</span> <span class="n">chrome</span><span class="p">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'id'</span><span class="p">)</span>
<span class="n">elm</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'[사용할 ID]'</span><span class="p">)</span>
<span class="n">elm</span> <span class="o">=</span> <span class="n">chrome</span><span class="p">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'password'</span><span class="p">)</span>
<span class="n">elm</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'[사용할 PW]'</span><span class="p">)</span>

<span class="n">elm</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="n">ENTER</span><span class="p">)</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">'https://mycompany.ahnlab.com/download'</span>
<span class="n">chrome</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">elm</span> <span class="o">=</span> <span class="n">chrome</span><span class="p">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s">'/html/body/div/div/div/div[3]/div[2]/div/div[4]/div[1]/span'</span><span class="p">)</span>
<span class="n">elm</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>

<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">elm</span> <span class="o">=</span> <span class="n">chrome</span><span class="p">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s">'//*[@id="k-panelbar-item-default-.0"]/div/div/div/div/table/tbody/tr[1]/td[1]/span[3]'</span><span class="p">)</span>
<span class="n">enginedate</span> <span class="o">=</span> <span class="n">elm</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'.'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">enginedate</span><span class="p">)</span>

<span class="c1">#exe, zip, ahc file download
</span><span class="k">print</span><span class="p">(</span><span class="s">"open zip ahc"</span><span class="p">)</span>
<span class="n">elm</span> <span class="o">=</span> <span class="n">chrome</span><span class="p">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s">'/html/body/div/div/div/div[3]/div[2]/div/div[4]/div[1]/span/p'</span><span class="p">)</span> <span class="c1"># zip ahc open
</span><span class="n">elm</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
<span class="n">elm</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"download zip file"</span><span class="p">)</span>
<span class="n">elm</span> <span class="o">=</span> <span class="n">chrome</span><span class="p">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s">'/html/body/div/div/div/div[3]/div[2]/div/div[4]/div[1]/div/div/div/div/table/tbody/tr[1]/td[2]/a[1]/button'</span><span class="p">)</span> <span class="c1"># zip down
</span><span class="n">elm</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"download ahc file"</span><span class="p">)</span>
<span class="n">elm</span> <span class="o">=</span> <span class="n">chrome</span><span class="p">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s">'/html/body/div/div/div/div[3]/div[2]/div/div[4]/div[1]/div/div/div/div/table/tbody/tr[1]/td[2]/a[2]/button'</span><span class="p">)</span> <span class="c1"># ahc down
</span><span class="n">elm</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"open hash"</span><span class="p">)</span>
<span class="n">elm</span> <span class="o">=</span> <span class="n">chrome</span><span class="p">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s">'/html/body/div/div/div/div[3]/div[2]/div/div[4]/div[1]/div/div/div/div/table/tbody/tr[1]/td[2]/button'</span><span class="p">)</span> <span class="c1"># ahc
</span><span class="n">elm</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ahnlab_ziphash</span> <span class="o">=</span> <span class="n">chrome</span><span class="p">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s">'/html/body/div/div/div/div[3]/div[2]/div/div[5]/div[2]/div[2]/table/tbody/tr[2]/td'</span><span class="p">).</span><span class="n">text</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"hash close"</span><span class="p">)</span>
<span class="n">elm</span> <span class="o">=</span> <span class="n">chrome</span><span class="p">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s">'/html/body/div/div/div/div[3]/div[2]/div/div[5]/div[2]/div[3]/button'</span><span class="p">)</span> <span class="c1"># hash close
</span><span class="n">elm</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"open exe"</span><span class="p">)</span>
<span class="n">elm</span> <span class="o">=</span> <span class="n">chrome</span><span class="p">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s">'/html/body/div/div/div/div[3]/div[2]/div/div[4]/div[2]/span/p'</span><span class="p">)</span> <span class="c1"># exe open
</span><span class="n">elm</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"download exe file"</span><span class="p">)</span>
<span class="n">elm</span> <span class="o">=</span> <span class="n">chrome</span><span class="p">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s">'/html/body/div/div/div/div[3]/div[2]/div/div[4]/div[2]/div/div/div/div/table/tbody/tr[1]/td[2]/a/button'</span><span class="p">)</span> <span class="c1"># exe
</span><span class="n">elm</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"open hash"</span><span class="p">)</span>
<span class="n">elm</span> <span class="o">=</span> <span class="n">chrome</span><span class="p">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s">'/html/body/div/div/div/div[3]/div[2]/div/div[4]/div[2]/div/div/div/div/table/tbody/tr[1]/td[2]/button'</span><span class="p">)</span> <span class="c1"># hash click
</span><span class="n">elm</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</code></pre></div></div>

<p>파일의 무결성을 검증하기위해 백신업체에서 제공하는 파일의 hash값을 검증하는 과정이 필요합니다. 파일의 hash값을 추출하기위해 <strong>sigcheck</strong>를 이용하겠습니다.</p>

<p>※ <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/sigcheck">sigcheck란?</a></p>

<p>python의 subprocess를 이용해 sigcheck.exe파일을 수행하겠습니다.</p>

<p>완료된 파일의 경로를 설정해주고, 10초마다 해당 경로에 파일이 있는지 검사합니다.
파일명이 있으면 다운로드 완료된것으로 간주합니다.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># download and check file download complete.
</span><span class="n">exepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">PROJECT_DIR</span><span class="si">}</span><span class="s">\download</span><span class="se">\\</span><span class="s">ahnlabengine_setup.exe'</span>
<span class="n">apcpath</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">PROJECT_DIR</span><span class="si">}</span><span class="s">\download</span><span class="se">\\</span><span class="s">ahnlabengine_apc.zip'</span>
<span class="n">ahcpath</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">PROJECT_DIR</span><span class="si">}</span><span class="s">\download</span><span class="se">\\</span><span class="s">ahnlabengine_apc.zip.ahc'</span>

<span class="k">print</span><span class="p">(</span><span class="s">"download process...."</span><span class="p">)</span>
<span class="k">while</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exepath</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">apcpath</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ahcpath</span><span class="p">):</span>
        <span class="k">break</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>

<p>subprocess를 통해 sigcheck를 실행하고, 다운로드 받은 파일의 hash(SHA256)값을 비교해봅니다.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># check hash SHA256
</span><span class="n">sig_exehash</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">check_output</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">PROJECT_DIR</span><span class="si">}</span><span class="s">\download\sigcheck64.exe'</span> <span class="o">+</span> <span class="s">" -h "</span> <span class="o">+</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">PROJECT_DIR</span><span class="si">}</span><span class="s">\download</span><span class="se">\\</span><span class="s">ahnlabengine_setup.exe | find </span><span class="se">\"</span><span class="s">SHA256</span><span class="se">\"</span><span class="s">'</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">strip</span><span class="p">()</span>
<span class="n">sig_apchash</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">check_output</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">PROJECT_DIR</span><span class="si">}</span><span class="s">\download\sigcheck64.exe'</span> <span class="o">+</span> <span class="s">" -h "</span> <span class="o">+</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">PROJECT_DIR</span><span class="si">}</span><span class="s">\download</span><span class="se">\\</span><span class="s">ahnlabengine_apc.zip | find </span><span class="se">\"</span><span class="s">SHA256</span><span class="se">\"</span><span class="s">'</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">strip</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="s">"ahnlabZIPHash : "</span> <span class="o">+</span> <span class="p">(</span><span class="n">sig_apchash</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)[</span><span class="mi">8</span><span class="p">:]).</span><span class="n">capitalize</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s">"ZIPfileHash   : "</span> <span class="o">+</span> <span class="p">(</span><span class="n">ahnlab_ziphash</span><span class="p">).</span><span class="n">capitalize</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s">"ahnlabEXEHash : "</span> <span class="o">+</span> <span class="p">(</span><span class="n">sig_exehash</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)[</span><span class="mi">8</span><span class="p">:]).</span><span class="n">capitalize</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s">"EXEfileHash   : "</span> <span class="o">+</span> <span class="p">(</span><span class="n">ahnlab_exehash</span><span class="p">).</span><span class="n">capitalize</span><span class="p">())</span>
</code></pre></div></div>

<p>다운로드 받은 파일을 usb에 엔진날짜명의 폴더(ex, 220401)를 생성해 이동시킵니다.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># file move to USB
</span><span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">usb_drive</span> <span class="o">+</span> <span class="n">enginedate</span><span class="p">)</span>
<span class="n">shutil</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">ahcpath</span><span class="p">,</span> <span class="n">usb_drive</span> <span class="o">+</span> <span class="n">enginedate</span><span class="p">)</span>
<span class="n">shutil</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">exepath</span><span class="p">,</span> <span class="n">usb_drive</span> <span class="o">+</span> <span class="n">enginedate</span><span class="p">)</span>
<span class="n">shutil</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">apcpath</span><span class="p">,</span> <span class="n">usb_drive</span> <span class="o">+</span> <span class="n">enginedate</span><span class="p">)</span>
</code></pre></div></div>

<p>전체 코드는 아래와 같습니다.</p>
<noscript><pre>#!/usr/bin/python
# main.py

import sys
import os
import time
import subprocess
import shutil

from chromedriver import generate_chrome
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.chrome.options import Options

PROJECT_DIR = str(os.path.dirname(os.path.abspath(__file__)))
DOWNLOAD_DIR = f&#39;{PROJECT_DIR}\download&#39;
driver_path = f&#39;{PROJECT_DIR}/lib/webDriver/&#39;

usb_drive = &#39;E:\\&#39;

platform = sys.platform
if platform == &#39;darwin&#39;:
    print(&#39;System platform : Darwin&#39;)
    driver_path += &#39;chromedriverMac&#39;
elif platform == &#39;linux&#39;:
    print(&#39;System platform : Linux&#39;)
    driver_path += &#39;chromedriverLinux&#39;
elif platform == &#39;win32&#39;:
    print(&#39;System platform : Window&#39;)
    driver_path += &#39;chromedriverWindow&#39;
else:
    print(f&#39;[{sys.platform}] not supported. Check your system platform.&#39;)
    raise Exception()

# 크롬 드라이버 인스턴스 생성    
chrome = generate_chrome(
    driver_path=driver_path,
    headless=False,
    download_path=DOWNLOAD_DIR)

# login ~ enter download page
url = &#39;https://mycompany.ahnlab.com/&#39;
chrome.get(url)
time.sleep(1.5) 

elm = chrome.find_element_by_xpath(&#39;//*[@id=&quot;root&quot;]/div/div[2]/div[1]/div[1]/button[1]/span[1]&#39;)
elm.click()
time.sleep(1)

elm = chrome.find_element_by_id(&#39;id&#39;)
elm.send_keys(&#39;[your ID]&#39;) 
elm = chrome.find_element_by_id(&#39;password&#39;)
elm.send_keys(&#39;[your PW]&#39;) 

elm.send_keys(Keys.ENTER)
time.sleep(1)

url = &#39;https://mycompany.ahnlab.com/download&#39;
chrome.get(url)
time.sleep(1) 

elm = chrome.find_element_by_xpath(&#39;/html/body/div/div/div/div[3]/div[2]/div/div[4]/div[1]/span&#39;)
elm.click()

time.sleep(1) 

elm = chrome.find_element_by_xpath(&#39;//*[@id=&quot;k-panelbar-item-default-.0&quot;]/div/div/div/div/table/tbody/tr[1]/td[1]/span[3]&#39;)
enginedate = elm.text.replace(&#39;.&#39;, &#39;&#39;)

print(enginedate)

#exe, zip, ahc file download
print(&quot;open zip ahc&quot;)
elm = chrome.find_element_by_xpath(&#39;/html/body/div/div/div/div[3]/div[2]/div/div[4]/div[1]/span/p&#39;) # zip ahc open
elm.click()
elm.click()
time.sleep(0.5)

print(&quot;download zip file&quot;)
elm = chrome.find_element_by_xpath(&#39;/html/body/div/div/div/div[3]/div[2]/div/div[4]/div[1]/div/div/div/div/table/tbody/tr[1]/td[2]/a[1]/button&#39;) # zip down
elm.click()
time.sleep(0.5)

print(&quot;download ahc file&quot;)
elm = chrome.find_element_by_xpath(&#39;/html/body/div/div/div/div[3]/div[2]/div/div[4]/div[1]/div/div/div/div/table/tbody/tr[1]/td[2]/a[2]/button&#39;) # ahc down
elm.click()
time.sleep(0.5)

print(&quot;open hash&quot;)
elm = chrome.find_element_by_xpath(&#39;/html/body/div/div/div/div[3]/div[2]/div/div[4]/div[1]/div/div/div/div/table/tbody/tr[1]/td[2]/button&#39;) # ahc
elm.click()
time.sleep(0.5)

ahnlab_ziphash = chrome.find_element_by_xpath(&#39;/html/body/div/div/div/div[3]/div[2]/div/div[5]/div[2]/div[2]/table/tbody/tr[2]/td&#39;).text
time.sleep(0.5)

print(&quot;hash close&quot;)
elm = chrome.find_element_by_xpath(&#39;/html/body/div/div/div/div[3]/div[2]/div/div[5]/div[2]/div[3]/button&#39;) # hash close
elm.click()
time.sleep(0.5)

print(&quot;open exe&quot;)
elm = chrome.find_element_by_xpath(&#39;/html/body/div/div/div/div[3]/div[2]/div/div[4]/div[2]/span/p&#39;) # exe open
elm.click()
time.sleep(0.5)

print(&quot;download exe file&quot;)
elm = chrome.find_element_by_xpath(&#39;/html/body/div/div/div/div[3]/div[2]/div/div[4]/div[2]/div/div/div/div/table/tbody/tr[1]/td[2]/a/button&#39;) # exe
elm.click()
time.sleep(0.5)

print(&quot;open hash&quot;)
elm = chrome.find_element_by_xpath(&#39;/html/body/div/div/div/div[3]/div[2]/div/div[4]/div[2]/div/div/div/div/table/tbody/tr[1]/td[2]/button&#39;) # hash click
elm.click()
time.sleep(0.5)

ahnlab_exehash = chrome.find_element_by_xpath(&#39;/html/body/div/div/div/div[3]/div[2]/div/div[5]/div[2]/div[2]/table/tbody/tr[2]/td&#39;).text

print(  &#39;zip SHA256: &#39; + ahnlab_ziphash, 
        &#39;exe SHA256: &#39; + ahnlab_exehash)

print(&quot;hash close&quot;)
elm = chrome.find_element_by_xpath(&#39;/html/body/div/div/div/div[3]/div[2]/div/div[5]/div[2]/div[3]/button&#39;) # hash close
elm.click()
time.sleep(1)

# download and check file download complete.
exepath = f&#39;{PROJECT_DIR}\download\\ahnlabengine_setup.exe&#39;
apcpath = f&#39;{PROJECT_DIR}\download\\ahnlabengine_apc.zip&#39;
ahcpath = f&#39;{PROJECT_DIR}\download\\ahnlabengine_apc.zip.ahc&#39;

print(&quot;download process....&quot;)    
while(True) :
    if os.path.exists(exepath) and os.path.exists(apcpath) and os.path.exists(ahcpath):
        break
    time.sleep(10)

# check hash SHA256
sig_exehash = subprocess.check_output(f&#39;{PROJECT_DIR}\download\sigcheck64.exe&#39; + &quot; -h &quot; + f&#39;{PROJECT_DIR}\download\\ahnlabengine_setup.exe | find \&quot;SHA256\&quot;&#39;, shell=True).strip()
sig_apchash = subprocess.check_output(f&#39;{PROJECT_DIR}\download\sigcheck64.exe&#39; + &quot; -h &quot; + f&#39;{PROJECT_DIR}\download\\ahnlabengine_apc.zip | find \&quot;SHA256\&quot;&#39;, shell=True).strip()

print(&quot;ahnlabZIPHash : &quot; + (sig_apchash.decode(&#39;utf-8&#39;)[8:]).capitalize())
print(&quot;ZIPfileHash   : &quot; + (ahnlab_ziphash).capitalize())
print(&quot;ahnlabEXEHash : &quot; + (sig_exehash.decode(&#39;utf-8&#39;)[8:]).capitalize())
print(&quot;EXEfileHash   : &quot; + (ahnlab_exehash).capitalize())

# file move to USB
os.makedirs(usb_drive + enginedate)
shutil.move(ahcpath, usb_drive + enginedate)
shutil.move(exepath, usb_drive + enginedate)
shutil.move(apcpath, usb_drive + enginedate)</pre></noscript>
<script src="https://gist.github.com/wind-flow/d649da7940c14cd8f22987fce1bed927.js"> </script>

<p><a href="https://github.com/wind-flow/avdownload">github 주소(https://github.com/wind-flow/avdownload)</a></p>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            <!-- 
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to wind-flow Tech Blog</h3>
                    <p>Get the latest posts delivered right to your inbox</p>
                    <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()" 
               id="searchtext" type="text" name="searchtext"  
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
                </section>
             -->

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/images/profile.png" alt="wind-flow" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/wind-flow">Kim-Gunwoo</a></h4>
                                
                                    <p>Finance Security IT Analyst</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/wind-flow">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            var this_page_url = 'https://wind-flow.github.io/automation';
                            var this_page_identifier = '/automation';
                            var this_page_title = '파일 다운로드 및 수정 자동화';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://xxxxxxxx.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/Definition-NFT">
                <div class="post-card-image" style="background-image: url(/assets/built/images/blockchain/NFT/NFT.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/Definition-NFT">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Blockchain</span>
                            
                        
                            
                                <span class="post-card-tags">Nft</span>
                            
                        
                    

                    <h2 class="post-card-title">NFT란?</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>NFT의 정의
NFT는 Non-Fungible Token의 약자로, 한국어로는 대체 불가능한 토큰을 뜻합니다.
NFT를 이해하기위해선 Fungible의 뜻을 이해해야 합니다.

</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/profile.png" alt="Kim-Gunwoo" />
                        
                        <span class="post-card-author">
                            <a href="/author/wind-flow/">Kim-Gunwoo</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://wind-flow.github.io/">
            
            <span>wind-flow Tech Blog</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">파일 다운로드 및 수정 자동화</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=%ED%8C%8C%EC%9D%BC+%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C+%EB%B0%8F+%EC%88%98%EC%A0%95+%EC%9E%90%EB%8F%99%ED%99%94&amp;url=https://wind-flow.github.io/automation"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://wind-flow.github.io/automation"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://wind-flow.github.io/">wind-flow Tech Blog</a> &copy; 2022</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyllt/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
    <div id="subscribe" class="subscribe-overlay">
        <a class="subscribe-overlay-close" href="#"></a>
        <div class="subscribe-overlay-content">
            
            <h1 class="subscribe-overlay-title">Search wind-flow Tech Blog</h1>
            <p class="subscribe-overlay-description">
            lunr.js를 이용한 posts 검색 </p>
            <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()" 
               id="searchtext" type="text" name="searchtext"  
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
        </div>
    </div>
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-xxxxxxxx-x', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
